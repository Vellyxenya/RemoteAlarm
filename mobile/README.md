# RemoteAlarm Mobile App

Flutter mobile application for recording and uploading short voice messages.

## Setup

### Prerequisites
- Flutter SDK (3.0.0 or later)
- Android Studio or VS Code with Flutter extensions
- Firebase CLI and FlutterFire CLI

See [../docs/flutter-setup.md](../docs/flutter-setup.md) for detailed setup instructions.

### Installation

1. **Initialize Flutter project** (if not already done):
   ```bash
   cd mobile
   flutter create . --org com.remotealarm
   ```

2. **Configure Firebase**:
   ```bash
   flutterfire configure
   ```
   Select the `remotealarm-be4d7` project.

3. **Install dependencies**:
   ```bash
   flutter pub get
   ```

4. **Run the app**:
   ```bash
   flutter run
   ```

## Features

### Audio Recording
- Record 1-5 second audio clips
- Uses device microphone
- WAV format (16kHz, 128kbps)
- Requires microphone permission

### Firebase Integration
- Anonymous authentication
- Upload to Firebase Storage (`/audio/*`)
- Automatic UUID-based filenames
- Upload triggers Cloud Function

## Project Structure

```
lib/
 main.dart                    # App entry point
 firebase_options.dart        # Firebase configuration
 screens/
    home_screen.dart        # Main UI
 services/
     audio_service.dart      # Audio recording logic
     storage_service.dart    # Firebase upload logic
```

## Dependencies

Core:
- `firebase_core` - Firebase SDK
- `firebase_auth` - Anonymous authentication
- `firebase_storage` - File uploads
- `record` - Audio recording
- `path_provider` - File system access
- `uuid` - Generate unique filenames
- `permission_handler` - Microphone permissions

## Permissions

### Android (`android/app/src/main/AndroidManifest.xml`)
```xml
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.INTERNET" />
```

### iOS (`ios/Runner/Info.plist`)
```xml
<key>NSMicrophoneUsageDescription</key>
<string>This app needs microphone access to record audio messages</string>
```

## Usage

1. **Open app** - Automatically signs in anonymously
2. **Tap "Start Recording"** - Begin audio capture
3. **Tap "Stop Recording"** - Save audio file
4. **Tap "Upload Audio"** - Upload to Firebase Storage
5. **Success!** - Cloud Function triggers ESP32 notification

## Firebase Configuration

The app requires `firebase_options.dart` generated by FlutterFire CLI:

```bash
flutterfire configure
```

This creates platform-specific Firebase configuration with:
- API keys
- Project ID: `remotealarm-be4d7`
- Storage bucket: `remotealarm-be4d7.appspot.com`

## Development

### Run in debug mode
```bash
flutter run
```

### Run tests
```bash
flutter test
```

### Build for release
```bash
# Android
flutter build apk --release

# iOS
flutter build ios --release
```

## Troubleshooting

### Microphone permission denied
- Check app permissions in device settings
- Ensure permissions are declared in AndroidManifest.xml/Info.plist

### Firebase upload fails
- Verify anonymous auth is enabled in Firebase Console
- Check storage rules allow authenticated writes to `/audio/*`
- Ensure internet connectivity

### App won't run
```bash
flutter clean
flutter pub get
flutter run
```

## Next Steps

After Phase 1 completion:
- Phase 2: Cloud Functions will process uploads
- Phase 3: MQTT broker will relay notifications
- Phase 4: ESP32 will receive and play audio